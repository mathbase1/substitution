<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GCSE Substitution Challenge</title>

  <!-- Tailwind for quick styling -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --brand:#2563eb;           /* blue-600 */
      --brand-2:#06b6d4;         /* cyan-500 */
      --ok:#10b981;              /* green-500 */
      --bad:#ef4444;             /* red-500 */
      --ink:#111827;             /* gray-900 */
    }

    /* ==== Global visuals =================================================== */
    body{
      min-height:100svh;
      background: radial-gradient(1200px 1200px at 10% -10%, rgba(99,102,241,.25), transparent 40%),
                  radial-gradient(1200px 1200px at 90% 110%, rgba(34,197,94,.20), transparent 40%),
                  linear-gradient(180deg, #f8fafc, #eef2ff);
      display:flex;align-items:center;justify-content:center;
      padding:2rem;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    }
    .glass{
      background:rgba(255,255,255,.85);
      backdrop-filter: blur(10px);
      border:1px solid rgba(255,255,255,.5);
    }

    /* Utility */
    .hidden{display:none;}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}

    /* ==== Inline math tokens ============================================== */
    .var{cursor:pointer;color:var(--brand);font-weight:700;display:inline-block;text-align:center;transition:min-width .1s, transform .15s;min-width:0.8em;}
    .var:hover{transform:translateY(-1px);}
    .var.filled{min-width:0;margin-right:0;}

    .times{margin:0 .25em;font-weight:700;}

    .inline-input,.answer-input{
      width:5rem;border-bottom:2px solid #9ca3af;text-align:center;outline:none;
      transition:border-color .15s, transform .12s;
    }
    .inline-input:focus,.answer-input:focus{border-color:var(--brand);transform:translateY(-1px);}

    .root{display:inline-flex;align-items:flex-end;}
    .root-sign{font-family:serif;font-weight:700;transform:scaleX(1.05) translateY(1px);}
    .radicand{border-top:2px solid currentColor;margin-left:.05em;padding-left:.15em;}
    .square-box{display:inline-block;vertical-align:super;font-size:1.1em;margin-left:-0.1em;}

    /* ==== Animations ======================================================= */
    @keyframes pop{0%{transform:scale(1)}50%{transform:scale(1.12)}100%{transform:scale(1)}}
    .pop{animation:pop .28s ease-out;}

    @keyframes shake{
      0%,100%{transform:translateX(0)}
      20%{transform:translateX(-9px)}
      40%{transform:translateX(8px)}
      60%{transform:translateX(-6px)}
      80%{transform:translateX(5px)}
    }
    .shake{animation:shake .38s ease-in-out;}

    @keyframes ring{
      0%{box-shadow:0 0 0 0 rgba(16,185,129,.55)}
      100%{box-shadow:0 0 0 24px rgba(16,185,129,0)}
    }
    .correct-glow{animation:ring .6s ease-out;}

    /* ==== Progress bar ===================================================== */
    .progress-track{height:.5rem;background:#e5e7eb;border-radius:9999px;overflow:hidden}
    .progress-bar{height:100%;width:0%;background:linear-gradient(90deg, var(--brand), var(--brand-2));transition:width .35s ease}

    /* ==== Confetti ========================================================= */
    #confetti{
      position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:60;
    }
    .confetti-piece{
      position:absolute;width:10px;height:14px;opacity:0;will-change:transform,opacity,background-color;
      animation:confetti-fall 1.25s ease-out forwards;
    }
    @keyframes confetti-fall{
      0%{transform:translate3d(var(--x,0), -10vh, 0) rotate(0deg);opacity:1}
      100%{transform:translate3d(var(--xend,0), 110vh, 0) rotate(var(--rot,360deg));opacity:0}
    }

    /* ==== Modal ============================================================ */
    .modal-backdrop{position:fixed;inset:0;background:rgba(15,23,42,.5);backdrop-filter:blur(4px);z-index:70;}
    .modal{max-width:28rem;margin-inline:auto;margin-top:10vh}
  </style>
</head>

<body>

  <!-- ---------- CONFETTI LAYER ---------- -->
  <div id="confetti" aria-hidden="true"></div>

  <!-- ---------- MENU ---------- -->
  <div id="menu" class="w-full max-w-xl glass shadow-2xl rounded-2xl p-6 sm:p-8 space-y-5">
    <div class="text-center">
      <h1 class="text-2xl sm:text-3xl font-extrabold text-gray-900">GCSE Substitution Challenge</h1>
      <p class="text-gray-600 mt-1">Substitute, evaluate, and race your way to the top score.</p>
    </div>

    <label class="block">
      <span class="font-semibold">Your name</span>
      <input id="studentName" type="text" class="mt-1 w-full border rounded-lg p-2.5" placeholder="Enter name" />
    </label>

    <label class="block">
      <span class="font-semibold">Game mode</span>
      <select id="gameMode" class="mt-1 w-full border rounded-lg p-2.5">
        <option value="timed">Timed</option>
        <option value="untimed">No time limit</option>
        <option value="target">Target score</option>
      </select>
    </label>

    <div id="timedOptions">
      <label class="font-semibold block mt-2">Duration</label>
      <select id="timeLimit" class="mt-1 w-full border rounded-lg p-2.5">
        <option value="300">5 minutes</option>
        <option value="600">10 minutes</option>
        <option value="900">15 minutes</option>
      </select>
    </div>

    <div id="targetOptions" class="hidden">
      <label class="font-semibold block mt-2">Target score</label>
      <input id="targetScore" type="number" min="1" class="mt-1 w-full border rounded-lg p-2.5" placeholder="e.g., 10" />
    </div>

    <button id="startGameBtn"
      class="w-full bg-gradient-to-r from-blue-600 to-cyan-500 hover:opacity-90 text-white py-3 rounded-xl shadow-lg font-semibold transition">
      Start Game
    </button>
  </div>

  <!-- ---------- GAME AREA ---------- -->
  <div id="gameArea" class="w-full max-w-3xl glass shadow-2xl rounded-2xl p-5 sm:p-8 hidden">
    <!-- Status + progress -->
    <div class="flex flex-col gap-3 mb-4">
      <div id="statusRow" class="text-base sm:text-lg font-semibold text-center"></div>
      <div id="progressWrap" class="progress-track hidden" aria-hidden="true">
        <div id="progressBar" class="progress-bar"></div>
      </div>
      <div class="text-center text-sm text-gray-500" id="helperText">Tip: click a letter to enter its value. Press <kbd class="px-1.5 py-0.5 border rounded">Enter</kbd> to check.</div>
      <div class="sr-only" aria-live="polite" aria-atomic="true" id="liveRegion"></div>
    </div>

    <p id="prompt" class="text-lg sm:text-xl mb-5 font-medium text-center"></p>

    <div id="equationRow" class="text-2xl sm:text-3xl font-semibold flex justify-center flex-wrap mb-5 break-words"></div>

    <div id="answerRow" class="text-2xl sm:text-3xl font-semibold flex justify-center items-center gap-2 mb-6 flex-wrap break-words"></div>

    <div class="flex justify-center">
      <button id="checkBtn"
        class="bg-gradient-to-r from-blue-600 to-cyan-500 hover:opacity-90 text-white py-2.5 px-8 rounded-xl shadow-lg font-semibold transition active:scale-[.98]">
        Check&nbsp;Answer
      </button>
    </div>

    <p id="feedback" class="text-xl font-semibold mt-6 text-center"></p>
  </div>

  <!-- ---------- END MODAL ---------- -->
  <div id="endModalWrap" class="modal-backdrop hidden">
    <div class="modal glass rounded-2xl p-6 shadow-2xl text-center">
      <h2 id="endHeading" class="text-2xl font-extrabold text-gray-900">Game Over</h2>
      <p id="endSummary" class="mt-3 text-gray-700"></p>
      <button id="playAgainBtn"
        class="mt-6 inline-flex items-center justify-center bg-gradient-to-r from-blue-600 to-cyan-500 text-white font-semibold px-6 py-2.5 rounded-xl shadow">
        Play again
      </button>
    </div>
  </div>

  <script>
    /* ---------- shared helpers & constants ---------- */
    const UMINUS="âˆ’", UDIV="Ã·", SUP2="Â²";
    const LETTERS=["x","y","a","b","c","d","m","n","r","s","t","u","v","w","z"];
    const rInt=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
    const pick=a=>a[rInt(0,a.length-1)];
    const pm=v=>v>=0?`+ ${v}`:`${UMINUS} ${Math.abs(v)}`;
    const show=v=>v<0?`${UMINUS} ${Math.abs(v)}`:v.toString();
    const randVar=ex=>{let l;do{l=pick(LETTERS);}while(ex.includes(l));return l;};

    /* NEW: format coefficient with no 1/-1 shown (uses UMINUS without a space) */
    const coef = (k) => {
      if (k === 1) return "";               // 1Â·x -> x
      if (k === -1) return UMINUS;          // -1Â·x -> âˆ’x
      return k < 0 ? `${UMINUS}${Math.abs(k)}` : `${k}`; // -3Â·x -> âˆ’3x
    };

    /* ---------- puzzle generators (functionality same; display uses coef()) ---------- */
    function oneVarLinear(){
      const result="y";
      const v=randVar([result]);
      const val=rInt(-9,9)||5, a=rInt(2,6), b=rInt(-9,9)||3;
      return{givenText:`Given ${v} = ${show(val)}`,
             vars:{[v]:val},
             displayRHS:`${coef(a)}${v} ${pm(b)}`,
             evalRHS:`${a}*${v} ${b>=0?'+':'-'} ${Math.abs(b)}`,
             resultVar:result};
    }
    function oneVarQuadratic(){
      const result="y";
      const v=randVar([result]);
      const val=rInt(-6,6)||4, a=rInt(1,3), b=rInt(-5,5);
      return{givenText:`Given ${v} = ${show(val)}`,
             vars:{[v]:val},
             displayRHS:`${coef(a)}${v}${SUP2} ${pm(b)}`,
             evalRHS:`${a}*(${v}**2) ${b>=0?'+':'-'} ${Math.abs(b)}`,
             resultVar:result};
    }
    function oneVarRoot(){
      const result="y";
      const v=randVar([result]);
      const k=rInt(2,9), val=k*k, c=rInt(1,5);
      return{givenText:`Given ${v} = ${val}`,
             vars:{[v]:val},
             displayRHS:`âˆš${v} + ${c}`,
             evalRHS:`Math.sqrt(${v})+${c}`,
             resultVar:result};
    }
    function oneVarDivide(){
      const result="y";
      const v=randVar([result]);
      const d=rInt(2,5), val=(rInt(-8,8)||3)*d, c=rInt(-4,4);
      // Divide display/eval kept in sync; pm(c) shown; eval uses same sign
      return{givenText:`Given ${v} = ${show(val)}`,
             vars:{[v]:val},
             displayRHS:`${v} ${UDIV} ${d} ${pm(c)}`,
             evalRHS:`${v}/${d} ${c>=0?'+':'-'} ${Math.abs(c)}`,
             resultVar:result};
    }
    function twoVarLinear(){
      const result="z";
      const v1=randVar([result]), v2=randVar([result,v1]);
      const val1=rInt(-9,9)||5, val2=rInt(-9,9)||4;
      const a=rInt(1,4), b=rInt(1,4), c=rInt(-6,6);
      return{givenText:`Given ${v1} = ${show(val1)}, ${v2} = ${show(val2)}`,
             vars:{[v1]:val1,[v2]:val2},
             displayRHS:`${coef(a)}${v1} + ${coef(b)}${v2} ${pm(c)}`,
             evalRHS:`${a}*${v1}+${b}*${v2} ${c>=0?'+':'-'} ${Math.abs(c)}`,
             resultVar:result};
    }
    function twoVarMix(){
      const result="z";
      const v1=randVar([result]), v2=randVar([result,v1]);
      const val1=rInt(-6,6)||3, val2=rInt(-6,6)||2, d=rInt(2,4);
      const sum=val1*val1+val2, adj=(d-(sum%d))%d, val2b=val2+adj;
      return{givenText:`Given ${v1} = ${show(val1)}, ${v2} = ${show(val2b)}`,
             vars:{[v1]:val1,[v2]:val2b},
             displayRHS:`(${v1}${SUP2} + ${v2}) ${UDIV} ${d}`,
             evalRHS:`(${v1}**2+${v2})/${d}`,
             resultVar:result};
    }
    function oneVarShiftSquare(){
      const result="y";
      const v=randVar([result]);
      const val=rInt(-9,9)||4, a=rInt(1,3), c=rInt(-5,5);
      return{givenText:`Given ${v} = ${show(val)}`,
             vars:{[v]:val},
             displayRHS:`(${v} ${UMINUS} ${a})${SUP2} ${pm(c)}`,
             evalRHS:`(${v}-${a})**2 ${c>=0?'+':'-'} ${Math.abs(c)}`,
             resultVar:result};
    }
    function oneVarProductShift(){
      const result="y";
      const v=randVar([result]);
      const val=rInt(-9,9)||3, b=rInt(1,5);
      return{givenText:`Given ${v} = ${show(val)}`,
             vars:{[v]:val},
             displayRHS:`${v} (${v} + ${b})`,
             evalRHS:`${v}*(${v}+${b})`,
             resultVar:result};
    }
    function twoVarSumDivide(){
      const result="z";
      const v1=randVar([result]), v2=randVar([result,v1]);
      const val1=rInt(-9,9)||3, val2=rInt(-9,9)||4, d=rInt(2,5);
      const sum=val1+val2, adj=(d-(sum%d))%d, val2b=val2+adj;
      return{givenText:`Given ${v1} = ${show(val1)}, ${v2} = ${show(val2b)}`,
             vars:{[v1]:val1,[v2]:val2b},
             displayRHS:`(${v1} + ${v2}) ${UDIV} ${d}`,
             evalRHS:`(${v1}+${v2})/${d}`,
             resultVar:result};
    }
    function twoVarWeightedSquares(){
      const result="z";
      const v1=randVar([result]), v2=randVar([result,v1]);
      const val1=rInt(-6,6)||2, val2=rInt(-6,6)||3, a=rInt(1,3), b=rInt(1,3);
      return{givenText:`Given ${v1} = ${show(val1)}, ${v2} = ${show(val2)}`,
             vars:{[v1]:val1,[v2]:val2},
             displayRHS:`${coef(a)}${v1}${SUP2} + ${coef(b)}${v2}${SUP2}`,
             evalRHS:`${a}*(${v1}**2)+${b}*(${v2}**2)`,
             resultVar:result};
    }
    function twoVarRootSum(){
      const result="r";
      const v1=randVar([result]), v2=randVar([result,v1]);
      const m=rInt(2,9), n=rInt(2,9), val1=m*m, val2=n*n;
      return{givenText:`Given ${v1} = ${val1}, ${v2} = ${val2}`,
             vars:{[v1]:val1,[v2]:val2},
             displayRHS:`âˆš${v1} + âˆš${v2}`,
             evalRHS:`Math.sqrt(${v1})+Math.sqrt(${v2})`,
             resultVar:result};
    }

    const makers=[
      oneVarLinear, oneVarQuadratic, oneVarRoot, oneVarDivide,
      twoVarLinear, twoVarMix,
      oneVarShiftSquare, oneVarProductShift, twoVarSumDivide,
      twoVarWeightedSquares, twoVarRootSum
    ];

    /* ---------- formatting helpers ---------- */
    const makeVar=l=>`<span class="var" data-var="${l}">${l}</span>`;
    function fmt(rhs,vars){
      const rx=new RegExp(Object.keys(vars).join("|"),"g");
      let html=rhs.replace(rx,m=>makeVar(m));
      html=html.replace(/Â²/g,'<span class="square-box">&sup2;</span>')
               .replace(/Ã·/g,'&divide;')
               .replace(/âˆ’/g,'&minus;')
               .replace(/âˆš(\s*(?:<span[^>]+?<\/span>|\d+\.?\d*))/g,
                 (_m,r)=>`<span class="root"><span class="root-sign">&radic;</span><span class="radicand">${r.trim()}</span></span>`);
      return html;
    }

    /* ---------- game state ---------- */
    let player="", mode="untimed", score=0, timeLeft=0, timer=null, target=null, current=null, timeMax=0;
    const puzzles=[], nextPuzzle=()=>{puzzles.push(pick(makers)());return puzzles[puzzles.length-1];};

    /* ---------- menu logic ---------- */
    const gameSel=document.getElementById("gameMode"),
          timedBox=document.getElementById("timedOptions"),
          targetBox=document.getElementById("targetOptions");
    gameSel.addEventListener("change",()=>{
      timedBox.classList.toggle("hidden",gameSel.value!=="timed");
      targetBox.classList.toggle("hidden",gameSel.value!=="target");
    });

    document.getElementById("startGameBtn").addEventListener("click",startGame);
    document.getElementById("studentName").addEventListener("keydown",e=>{
      if(e.key==="Enter") document.getElementById("startGameBtn").click();
    });

    function startGame(){
      player=(document.getElementById("studentName").value.trim())||"Player";
      mode=gameSel.value; score=0;
      if(mode==="timed"){ timeLeft=parseInt(document.getElementById("timeLimit").value,10); timeMax=timeLeft; }
      if(mode==="target"){ target=parseInt(document.getElementById("targetScore").value,10)||10; }

      document.getElementById("menu").classList.add("hidden");
      document.getElementById("gameArea").classList.remove("hidden");
      updateStatus(); updateProgress();

      if(mode==="timed"){
        timer=setInterval(()=>{
          timeLeft--; updateStatus(); updateProgress();
          if(timeLeft<=0){ endGame("Time's up!"); }
        },1000);
      }
      loadPuzzle();
    }

    const fmtTime=s=>`${String(Math.floor(s/60)).padStart(2,"0")}:${String(s%60).padStart(2,"0")}`;

    function updateStatus(){
      let txt=`Score: ${score}`;
      if(mode==="timed") txt=`${player?player+" Â· ":""}${txt} Â· Time: ${fmtTime(Math.max(0,timeLeft))}`;
      else if(mode==="target") txt=`${player?player+" Â· ":""}Score: ${score}/${target}`;
      else if(player) txt=`${player} Â· ${txt}`;
      document.getElementById("statusRow").textContent=txt;
      document.getElementById("statusRow").classList.add("pop");
      setTimeout(()=>document.getElementById("statusRow").classList.remove("pop"),280);
      document.getElementById("liveRegion").textContent=txt;
    }

    function updateProgress(){
      const wrap=document.getElementById("progressWrap");
      const bar=document.getElementById("progressBar");
      if(mode==="timed"){
        wrap.classList.remove("hidden");
        const pct=timeMax? Math.max(0, Math.min(1, timeLeft/timeMax))*100 : 0;
        bar.style.width=pct+"%";
      }else if(mode==="target"){
        wrap.classList.remove("hidden");
        const pct=Math.max(0, Math.min(1, score/(target||1)))*100;
        bar.style.width=pct+"%";
      }else{
        wrap.classList.add("hidden");
      }
    }

    /* ---------- puzzle flow ---------- */
    function loadPuzzle(){
      current=nextPuzzle();
      document.getElementById("prompt").textContent=`${current.givenText}, find ${current.resultVar}`;
      document.getElementById("equationRow").innerHTML=`${current.resultVar} = ${fmt(current.displayRHS,current.vars)}`;
      document.getElementById("answerRow").innerHTML=`${current.resultVar} = <input type="number" class="answer-input rounded px-1" placeholder="?">`;

      document.querySelectorAll(".var").forEach(el=>el.addEventListener("click",()=>editVar(el)));
      document.getElementById("feedback").textContent="";
      const ans=document.querySelector(".answer-input");
      if(ans){
        ans.focus();
        ans.addEventListener("keydown",e=>{
          if(e.key==="Enter"){
            document.getElementById("checkBtn").click();
          }
        });
      }
    }

    function editVar(span){
      if(span.querySelector("input"))return;
      const letter=span.dataset.var, cur=span.dataset.filled||"";
      const inp=document.createElement("input");
      inp.type="number"; inp.className="inline-input rounded px-1"; inp.value=cur; inp.placeholder="?";
      inp.addEventListener("keydown",e=>{ if(e.key==="Enter") inp.blur(); });
      inp.addEventListener("blur",()=>{
        const v=inp.value.trim();
        if(v===""||isNaN(v)){
          span.textContent=letter; span.classList.remove("filled"); delete span.dataset.filled;
        }else{
          span.textContent=Number(v); span.dataset.filled=Number(v); span.classList.add("filled"); addTimesIfCoeff(span);
        }
      });
      span.textContent=""; span.appendChild(inp); inp.focus();
    }

    function addTimesIfCoeff(span){
      const prev=span.previousSibling;
      if(prev && prev.nodeType===3 && /\d$/.test(prev.textContent)){
        const mult=document.createElement("span");
        mult.className="times"; mult.textContent="Ã—";
        prev.parentNode.insertBefore(mult,span);
      }
    }

    /* ---------- checking & feedback ---------- */
    document.getElementById("checkBtn").addEventListener("click",()=>{
      if(mode==="timed" && timeLeft<=0) return;

      const gameCard=document.getElementById("gameArea");
      const fb=document.getElementById("feedback");

      for(const [v,exp] of Object.entries(current.vars)){
        const el=document.querySelector(`.var[data-var='${v}']`);
        if(!el || Number(el.dataset.filled)!==exp){
          fb.textContent="Almost! Check the values you substituted.";
          fb.className="text-xl font-bold mt-6 text-center text-red-600";
          nudge(gameCard);
          return;
        }
      }

      const ansVal=document.querySelector(".answer-input").value.trim();
      if(ansVal===""){
        fb.textContent=`Enter a value for ${current.resultVar}.`;
        fb.className="text-xl font-bold mt-6 text-center text-red-600";
        nudge(gameCard);
        return;
      }

      const expected=Math.round(Function(...Object.keys(current.vars),`return ${current.evalRHS};`)(...Object.values(current.vars)));
      if(Number(ansVal)!==expected){
        fb.textContent="That's not correct. Try again.";
        fb.className="text-xl font-bold mt-6 text-center text-red-600";
        nudge(gameCard);
        return;
      }

      // Correct!
      score++; updateStatus(); updateProgress();
      fb.textContent="Correct! ðŸŽ‰";
      fb.className="text-xl font-bold mt-6 text-center text-green-600";
      pulse(gameCard);
      fireConfetti(180);

      if(mode==="target" && score>=target){ endGame("Target reached!"); return; }

      setTimeout(loadPuzzle, 950);
    });

    function nudge(el){ el.classList.add("shake"); setTimeout(()=>el.classList.remove("shake"), 400); }
    function pulse(el){ el.classList.add("correct-glow"); setTimeout(()=>el.classList.remove("correct-glow"), 650); }

    /* ---------- end game ---------- */
    function endGame(msg){
      clearInterval(timer);
      document.getElementById("checkBtn").disabled=true;

      const wrap=document.getElementById("endModalWrap");
      const heading=document.getElementById("endHeading");
      const summary=document.getElementById("endSummary");

      heading.textContent=msg||"Game Over";
      const details = (mode==="timed") ? `Final score: <strong>${score}</strong> in ${fmtTime(timeMax)}.`
                     : (mode==="target") ? `Target: <strong>${target}</strong> Â· Your score: <strong>${score}</strong>.`
                     : `Final score: <strong>${score}</strong>.`;
      summary.innerHTML=details;
      wrap.classList.remove("hidden");
      if(mode==="target" && score>=target) fireConfetti(240);
    }
    document.getElementById("playAgainBtn").addEventListener("click",()=>location.reload());

    /* ---------- Confetti (no libraries) ---------- */
    function fireConfetti(count=160){
      const layer=document.getElementById("confetti");
      const colors=["#ef4444","#f59e0b","#10b981","#3b82f6","#8b5cf6","#ec4899","#06b6d4","#f97316"];
      const centerX=window.innerWidth*0.5;

      for(let i=0;i<count;i++){
        const piece=document.createElement("span");
        piece.className="confetti-piece";
        const size = 8 + Math.random()*8;
        const startX = centerX + (Math.random()*window.innerWidth*0.6 - window.innerWidth*0.3);
        const drift = (Math.random()*200 - 100);
        const rot = (Math.random()*720+180)*(Math.random()<.5?-1:1);
        piece.style.left = `${startX}px`;
        piece.style.top = `-16px`;
        piece.style.width = `${size}px`;
        piece.style.height = `${size*1.4}px`;
        piece.style.backgroundColor = colors[i % colors.length];
        piece.style.setProperty('--x','0px');
        piece.style.setProperty('--xend', `${drift}px`);
        piece.style.setProperty('--rot', `${rot}deg`);
        piece.style.animationDelay = `${Math.random()*0.15}s`;
        layer.appendChild(piece);
        setTimeout(()=>piece.remove(), 1600);
      }
    }

    // (No skip button anywhere â€” per requirement)
  </script>
</body>
</html>
